name: SPaDE - Test in Container

on:
  pull_request:
    types: [opened, synchronize, reopened]
  workflow_dispatch:

env:
  REGISTRY: ghcr.io
  IMAGE_NAME: rbjones/spade

jobs:
  test:
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/rbjones/spade:latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Verify ProofPower environment
        run:
          make test
      
      - name: Install Python dependencies
        run: |
          # Install any project-level requirements
          for req in requirements.txt kr/requirements.txt di/agprop/requirements.txt; do
            if [ -f "$req" ]; then
              echo "Installing from $req..."
              pip3 install -r "$req"
            fi
          done
        
      - name: Run tests
        run: |
          make
      
      - name: Test summary
        run: echo "Test completed."

